<?php

// Cr√©e un trait 'Attaquant' avec :
// - M√©thode attaquer($cible) qui :
//   * Inflige $this->attaque points de d√©g√¢ts √† la cible
//   * Affiche "‚öîÔ∏è [nom] attaque [cible] et inflige X d√©g√¢ts !"
//   * Appelle $cible->recevoirDegats($degats)

trait Attaquant
{
    function attaquer($cible)
    {
        echo "‚öîÔ∏è ", $this->nom, " attaque ", $cible->nom, " et inflige ", $this->attaque, " d√©g√¢ts !\n";
        $cible->recevoirDegats($this->attaque);;
    }
}

// Cr√©e une classe ABSTRAITE 'Personnage' avec :
// - Propri√©t√© STATIC private $totalPersonnages = 0
// - Propri√©t√©s PROTECTED : $nom, $vie, $attaque
// - Propri√©t√© PRIVATE : $estVivant = true
// - Constructeur qui :
//   * Incr√©mente $totalPersonnages
//   * Initialise nom, vie, attaque
//   * Affiche "‚ú® [nom] entre dans l'ar√®ne ! (Vie: X, Attaque: Y)"
// - M√©thode recevoirDegats($degats) qui :
//   * R√©duit $vie
//   * Si vie <= 0 : met $estVivant √† false et affiche "üíÄ [nom] est KO !"
//   * Sinon : affiche "üíî [nom] a X PV restants"
// - M√©thode getEstVivant() qui retourne $estVivant
// - M√©thode STATIC getTotalPersonnages()
// - M√©thode ABSTRAITE crier() (chaque personnage crie diff√©remment)

abstract class Personnage
{
    static private $totalPersonnages = 0;
    protected $nom, $vie, $attaque;
    private $estVivant = true;

    function __construct($nom, $vie, $attaque)
    {
        self::$totalPersonnages++;

        $this->nom = $nom;
        $this->vie = $vie;
        $this->attaque = $attaque;

        echo "‚ú® ", $this->nom, " entre dans l'ar√®ne ! (Vie: ", $this->vie, ", Attaque: ",
        $this->attaque, ")\n";
    }

    function getNom()
    {
        return $this->nom;
    }

    function recevoirDegats($degats)
    {
        $this->vie -= $degats;
        // Si vie <= 0 : met $estVivant √† false et affiche "üíÄ [nom] est KO !"
        if ($this->vie <= 0) {
            $this->estVivant = false;
            echo "üíÄ ", $this->nom, " est KO !\n";
        } else {
            echo "üíî ", $this->nom, " a ", $this->vie, " PV restants\n";
        }
    }

    // - M√©thode getEstVivant() qui retourne $estVivant
    function estVivant()
    {
        return $this->estVivant;
    }

    // - M√©thode STATIC getTotalPersonnages()
    static function getTotalPersonnages()
    {
        return self::$totalPersonnages;
    }

    // - M√©thode ABSTRAITE crier() (chaque personnage crie diff√©remment)
    abstract function crier();
}

// Cr√©e une classe 'Guerrier' qui :
// - H√âRITE de Personnage
// - UTILISE le trait Attaquant
// - Constructeur : appelle parent avec vie=100, attaque=20
// - M√©thode crier() : "üó°Ô∏è POUR L'HONNEUR !"

class Guerrier extends Personnage
{
    use Attaquant;

    function __construct($nom)
    {
        return parent::__construct($nom, $vie = 100, $attaque = 20);
    }

    function crier()
    {
        echo "üó°Ô∏è POUR L'HONNEUR !\n";
    }
}

// Cr√©e une classe 'Mage' qui :
// - H√âRITE de Personnage
// - UTILISE le trait Attaquant
// - Constructeur : appelle parent avec vie=70, attaque=35
// - M√©thode crier() : "üîÆ PAR LA MAGIE !"
// - M√©thode BONUS sortSpecial($cible) : inflige 50 d√©g√¢ts fixes
//   * Affiche "‚ú® [nom] lance BOULE DE FEU ! üí•"

class Mage extends Personnage
{
    use Attaquant;

    function __construct($nom)
    {
        return parent::__construct($nom, $vie = 70, $attaque = 35);
    }

    function sortSpecial($cible)
    {
        //inflige 50 d√©gats
        echo "‚ú® ", $this->nom, " lance BOULE DE FEU ! üí•\n";
        $cible->recevoirDegats(50);
    }

    function crier()
    {
        echo "üîÆ PAR LA MAGIE !\n";
    }
}

// Cr√©e une classe 'Archer' qui :
// - H√âRITE de Personnage
// - UTILISE le trait Attaquant
// - Constructeur : appelle parent avec vie=80, attaque=25
// - M√©thode crier() : "üèπ TIR MORTEL !"
class Archer extends Personnage
{
    use Attaquant;

    function __construct($nom)
    {
        return parent::__construct($nom, $vie = 80, $attaque = 25);
    }

    function crier()
    {
        echo "üèπ TIR MORTEL !\n";
    }
}

// Cr√©e une classe 'Arene' avec :
// - M√©thode combat($perso1, $perso2) qui :
//   * Affiche "‚öîÔ∏è COMBAT : [nom1] VS [nom2]"
//   * Les deux personnages crient
//   * Tour par tour jusqu'√† ce qu'un personnage soit KO
//   * Retourne le gagnant

class Arene
{
    function combat($perso1, $perso2)
    {
        echo "‚öîÔ∏è COMBAT : ", $perso1->getNom(), " VS ", $perso2->getNom(), "\n";
        $perso1->crier();
        $perso2->crier();
        //Who moves first: random.
        $char = [1 => $perso1, 2 => $perso2];
        $first = mt_rand(1, 2);
        $second = $first == 1 ? 2 : 1;
        //first move
        while ($char[$first]->estVivant() and $char[$second]->estVivant()) {
            if ($char[$first] instanceof Mage) {
                $char[$first]->sortSpecial($char[$second]);
            } else {
                $char[$first]->attaquer($char[$second]);
            }

            if (!$char[$second]->estVivant()) {
                break;
            }

            if ($char[$second] instanceof Mage) {
                $char[$second]->sortSpecial($char[$first]);
            } else {
                $char[$second]->attaquer($char[$first]);
            }
        }
        if ($char[$first]->estVivant()) {
            echo $char[$first]->getNom(), " REMPORTE LA VICTOIRE! üèÜ\n";
            return $char[$first];
        } else {
            echo $char[$second]->getNom(), " REMPORTE LA VICTOIRE! üèÜ\n";
            return $char[$second];
        }
    }
}

// 1. Cr√©e 3 personnages :
//    - Conan le Guerrier
//    - Gandalf le Mage
//    - Legolas l'Archer
$mage = new Mage("Gandalf");
$warrior = new Guerrier("Conan");
$archer = new Archer("Legolas");

// 2. Cr√©e une Arene
$arena = new Arene;

// 3. Fais combattre :
//    - Combat 1 : Conan VS Gandalf
//    - Le mage utilise son sort sp√©cial !
//    - Combat 2 : Le gagnant VS Legolas
$combat1 = $arena->combat($mage, $warrior);
$combat2 = $arena->combat($combat1, $archer);

// 4. Affiche les statistiques :
//    - Total de personnages cr√©√©s
//    - Le CHAMPION final
echo "Personnages cr√©√©s : ", Personnage::getTotalPersonnages(), ".\n";
echo "üèÜ Le grand gagnant du tournoi est: ", $combat2->getNom(), " ! üèÜ\n";
